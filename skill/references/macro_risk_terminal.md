# 多市场宏观风控终端 (Multi-Market Macro Risk Terminal)

本文件定义了多市场宏观风控终端的指标体系、状态判断规则和历史对标参考。第0层宏观风控终端根据分析标的所在市场，自动适配对应国家/地区的宏观指标体系。

## 目录

1. [市场自动检测规则](#市场自动检测规则)
2. [A股 (CN) 指标体系](#a股-cn-指标体系)
3. [美股 (US) 指标体系](#美股-us-指标体系)
4. [综合风控信号（通用）](#综合风控信号通用)
5. [数据获取方法](#数据获取方法)
6. [扩展新市场](#扩展新市场)

---

## 市场自动检测规则

| 标的特征 | 检测结果 | 示例 |
|:---|:---|:---|
| 代码含 `.SZ` / `.SH` / `.BJ` | CN (A股) | 000001.SZ, 600000.SH |
| 纯字母代码 | US (美股) | AAPL, MSFT, NVDA |
| 代码含 `.HK` | HK (港股) | 0700.HK |
| 显式指定 `market` 参数 | 优先使用指定值 | `market="US"` |

---

## A股 (CN) 指标体系

### 四大模块总览

| 模块 | 核心指标 | 状态判断维度 |
|:---|:---|:---|
| 资金杠杆与情绪 (Leverage) | 两融余额、两融/流通市值比 | 极度疯狂 / 偏热 / 结构健康 / 偏冷 |
| 经济景气度 (Growth) | GDP同比增速 | 增速 / 放缓 / 衰退 |
| 整体估值锚 (Valuation) | A股总市值、年度GDP预估、巴菲特指标 | 极度高估 / 估值偏高 / 合理 / 低估 / 极度低估 |
| 通胀与货币 (Inflation & Money) | CPI同比、PPI同比、M1-M2剪刀差、M2增速、社融当月增量 | 各指标独立判断 |

### 资金杠杆与情绪 (Leverage)

**指标定义**:
- **两融余额**: 融资融券余额总量（万亿元），反映市场杠杆资金规模
- **两融/流通市值比**: 两融余额占A股流通市值的比例（%），反映杠杆资金相对规模

**状态判断规则**:

| 两融/流通市值比 | 状态 | 信号 |
|:---|:---|:---|
| > 4.0% | 极度疯狂 | 🔴 强烈风险预警 |
| 3.0% - 4.0% | 偏热 | 🟡 注意风险 |
| 2.0% - 3.0% | 结构健康 | 🟢 正常 |
| 1.5% - 2.0% | 偏冷 | 🟡 关注机会 |
| < 1.5% | 极度冷清 | 🔵 底部区域 |

**历史大顶对标**: 2015年疯牛顶 — 两融余额 2.27万亿，占流通市值比 4.5%

### 经济景气度 (Growth)

| GDP同比增速 | 状态 | 说明 |
|:---|:---|:---|
| > 6.0% | 高速增长 | 经济过热风险 |
| 5.0% - 6.0% | 稳健增长 | 经济健康 |
| 4.0% - 5.0% | 中速增长 | 增速放缓 |
| 3.0% - 4.0% | 低速增长 | 经济下行压力 |
| < 3.0% | 增长乏力 | 衰退风险 |

### 整体估值锚 (Valuation)

**巴菲特指标** = A股总市值 / 年度GDP × 100%

| 巴菲特指标 | 状态 | 信号 |
|:---|:---|:---|
| > 120% | 极度高估 | 🔴 泡沫区域 |
| 100% - 120% | 估值偏高 | 🟡 注意风险 |
| 80% - 100% | 合理偏高 | 🟡 谨慎乐观 |
| 60% - 80% | 合理区间 | 🟢 正常 |
| 40% - 60% | 低估区间 | 🟢 安全区域 |
| < 40% | 极度低估 | 🔵 历史底部 |

**历史大顶参考**: 2007年疯牛顶 ~125%, 2015年疯牛顶 ~110%, 底部安全区间 40%-60%

### 通胀与货币 (Inflation & Money)

| 指标 | 判断标准 |
|:---|:---|
| CPI同比 | >3%通胀偏高🟡, 1-3%温和🟢, 0-1%低通胀🟡, <0%通缩🔴 |
| PPI同比 | >5%过热🔴, 0-5%正常🟢, -3~0%下行🟡, <-3%工业通缩🔴 |
| M1-M2剪刀差 | >0资金活化🟢, -3~0轻度定期化🟡, <-3存款定期化🔴 |
| M2增速 | >10%宽松🟢, 8-10%适度🟡, <8%偏紧🔴 |
| 社融当月增量 | 需与历史同期对比: 高于同期🟢, 接近同期🟡, 低于同期🔴 |

**数据源优先级**: Tushare > AKShare > 手动输入

---

## 美股 (US) 指标体系

### 五大模块总览

| 模块 | 核心指标 | 状态判断维度 |
|:---|:---|:---|
| 货币政策 (Monetary Policy) | 联邦基金利率、美联储资产负债表 | 紧缩 / 偏紧 / 中性 / 宽松 |
| 经济增长 (Growth) | GDP年化季环比、失业率 | 强劲 / 温和 / 放缓 / 衰退 |
| 整体估值 (Valuation) | 巴菲特指标(Wilshire 5000/GDP)、Shiller PE(CAPE) | 极度高估 / 偏高 / 合理 / 低估 |
| 通胀 (Inflation) | CPI同比、PPI同比、核心PCE | 高通胀 / 偏高 / 温和 / 低通胀 / 通缩 |
| 情绪与收益率曲线 (Sentiment & Yield Curve) | 10Y-2Y国债利差、消费者信心指数、VIX恐慌指数 | 恐慌 / 偏高 / 正常 / 平静 |

### 货币政策 (Monetary Policy)

#### 联邦基金利率 (Federal Funds Rate)

| 利率水平 | 状态 | 信号 | 说明 |
|:---|:---|:---|:---|
| >= 5.0% | 紧缩 | 🔴 | 高利率环境，压制估值 |
| 3.0% - 5.0% | 偏紧 | 🟡 | 关注转向信号 |
| 1.0% - 3.0% | 中性 | 🟢 | 利率适中 |
| < 1.0% | 宽松 | 🟢 | 低利率，利好风险资产 |

#### 美联储资产负债表

- **> 8万亿美元**: 流动性充裕 🟢
- **6-8万亿美元**: 缩表进行中 🟡
- **< 6万亿美元**: 疫情前正常水平 🟢

**参考**: 疫情后峰值约9万亿美元，2020年前约4万亿美元

### 经济增长 (Growth)

#### GDP年化季环比

| GDP增速 | 状态 | 信号 |
|:---|:---|:---|
| > 3.0% | 强劲增长 | 🟢 |
| 1.5% - 3.0% | 温和增长 | 🟢 |
| 0% - 1.5% | 增长放缓 | 🟡 |
| -1.0% - 0% | 接近衰退 | 🟡 |
| < -1.0% | 衰退 | 🔴 |

#### 失业率

| 失业率 | 状态 | 信号 |
|:---|:---|:---|
| > 7.0% | 高失业 | 🔴 经济衰退信号 |
| 5.0% - 7.0% | 偏高 | 🟡 就业市场走弱 |
| 4.0% - 5.0% | 正常 | 🟢 就业市场健康 |
| < 4.0% | 充分就业 | 🟢 强劲，可能推升通胀 |

### 整体估值 (Valuation)

#### 巴菲特指标 (Wilshire 5000 / GDP)

| 巴菲特指标 | 状态 | 信号 |
|:---|:---|:---|
| > 200% | 极度高估 | 🔴 |
| 150% - 200% | 显著高估 | 🟡 |
| 120% - 150% | 偏高 | 🟡 |
| 80% - 120% | 合理区间 | 🟢 |
| 60% - 80% | 低估 | 🟢 |
| < 60% | 极度低估 | 🔵 |

**历史大顶参考**: 2000年互联网泡沫 ~183%, 2021年流动性泡沫 ~205%, 合理区间 80%-120%

注意: 美股巴菲特指标的阈值与A股不同，因为美股市场结构、跨国公司收入占比等因素导致美股长期中枢偏高。

#### Shiller PE (CAPE)

| CAPE | 状态 | 信号 |
|:---|:---|:---|
| > 35x | 显著高估 | 🔴 |
| 25x - 35x | 偏高 | 🟡 |
| 15x - 25x | 合理 | 🟢 |
| < 15x | 低估 | 🔵 |

**参考**: Shiller PE 历史均值约17x

### 通胀 (Inflation)

#### CPI同比

| CPI | 状态 | 信号 | 说明 |
|:---|:---|:---|:---|
| > 5.0% | 高通胀 | 🔴 | 远超美联储2%目标 |
| 3.0% - 5.0% | 通胀偏高 | 🟡 | 高于目标 |
| 1.5% - 3.0% | 温和通胀 | 🟢 | 接近目标 |
| 0% - 1.5% | 低通胀 | 🟡 | 通缩风险 |
| < 0% | 通缩 | 🔴 | 经济收缩信号 |

#### PPI同比

| PPI | 状态 | 信号 |
|:---|:---|:---|
| > 5.0% | 生产成本过热 | 🔴 |
| 2.0% - 5.0% | 偏高 | 🟡 |
| 0% - 2.0% | 正常 | 🟢 |
| < 0% | 生产通缩 | 🟡 |

#### 核心PCE同比（美联储首选通胀指标）

| 核心PCE | 状态 | 信号 |
|:---|:---|:---|
| > 4.0% | 核心通胀过高 | 🔴 |
| 2.5% - 4.0% | 高于目标 | 🟡 |
| 1.5% - 2.5% | 接近目标 | 🟢 |
| < 1.5% | 低于目标 | 🟡 |

### 情绪与收益率曲线 (Sentiment & Yield Curve)

#### 10Y-2Y国债利差

| 利差 | 状态 | 信号 | 说明 |
|:---|:---|:---|:---|
| < -50bp | 深度倒挂 | 🔴 | 强烈衰退预警，历史上倒挂后12-18个月常出现衰退 |
| -50bp - 0 | 倒挂 | 🔴 | 衰退预警信号 |
| 0 - 50bp | 平坦 | 🟡 | 经济周期后期 |
| > 50bp | 正常 | 🟢 | 经济扩张期 |

#### 消费者信心指数（密歇根大学）

| 指数值 | 状态 | 信号 |
|:---|:---|:---|
| > 90 | 乐观 | 🟢 |
| 70 - 90 | 中性 | 🟢 |
| 55 - 70 | 悲观 | 🟡 |
| < 55 | 极度悲观 | 🔴 |

**参考**: 历史均值约85, 2022年低点约50

#### VIX恐慌指数

| VIX | 状态 | 信号 | 说明 |
|:---|:---|:---|:---|
| > 30 | 恐慌 | 🔴 | 市场极度恐慌，可能是逆向买入机会 |
| 20 - 30 | 偏高 | 🟡 | 市场不确定性增加 |
| 12 - 20 | 正常 | 🟢 | 市场情绪稳定 |
| < 12 | 极度平静 | 🟡 | 可能过度自满，警惕黑天鹅 |

**数据源优先级**: FRED > yfinance > AKShare

---

## 综合风控信号（通用）

所有市场使用统一的综合风控信号计算逻辑:

| 综合信号 | 触发条件 | 仓位建议 | 策略调整 |
|:---|:---|:---|:---|
| 🔴 高风险 | 任意2个模块出现红色信号 | ≤30% | 防御为主，优先现金和低波动资产 |
| 🟡 中风险 | 任意1个红色或2个黄色信号 | 30%-60% | 控制仓位，精选高质量个股 |
| 🟢 低风险 | 多数模块为绿色信号 | 60%-90% | 正常配置，积极布局成长股 |
| 🔵 极低风险 | 多数模块处于底部/低估区域 | 80%-100% | 加大配置，逆向布局超跌优质股 |

---

## 数据获取方法

使用 `scripts/v2.5/cn_macro_data/macro_risk_terminal.py` 脚本获取所有指标数据。

### 自动适配用法

```python
from scripts.v2.5.cn_macro_data.macro_risk_terminal import create_terminal, detect_market

# 方式1: 根据标的自动检测市场
market = detect_market(tickers=["AAPL", "MSFT"])  # → "US"
market = detect_market(tickers=["000001.SZ"])       # → "CN"

# 方式2: 显式指定市场
terminal = create_terminal("US", fred_api_key="YOUR_KEY")
terminal = create_terminal("CN", tushare_token="YOUR_TOKEN")

report = terminal.generate_risk_report()
markdown = terminal.format_report_markdown(report)
```

### 向后兼容用法

```python
from scripts.v2.5.cn_macro_data.macro_risk_terminal import MacroRiskTerminal

# MacroRiskTerminal 仍然可用，等同于 CNMacroRiskTerminal
terminal = MacroRiskTerminal(tushare_token="YOUR_TOKEN")
```

每个指标的数据获取、计算过程和判断逻辑必须在报告中完整展示，确保用户能理解分析过程。

---

## 扩展新市场

要添加新市场（如港股HK、欧洲EU、日本JP），需要:

1. 继承 `MacroRiskTerminalBase` 基类
2. 设置 `MARKET` 和 `MARKET_NAME` 类属性
3. 实现 `get_modules()` 方法，返回该市场的宏观风控模块列表
4. 在 `create_terminal()` 工厂函数中注册新市场
5. 在本文档中添加对应的指标体系说明

```python
class HKMacroRiskTerminal(MacroRiskTerminalBase):
    MARKET = "HK"
    MARKET_NAME = "港股"

    def get_modules(self) -> List[ModuleResult]:
        # 实现港股特有的宏观风控模块
        # 如: 联系汇率、港股通资金流、恒生指数PE等
        ...
```
